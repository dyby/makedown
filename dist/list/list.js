/*! Milanoo 2015-05-05 */
define("moreview",function(a){function b(a,b){this.target=a,this.loading=!1,this.opt={onNode:"li",loading:"loading",error:"error",tipsLocked:!0,yOffset:0,updateHref:!0,isAnimate:!0,onFinish:function(){}},$.extend(this.opt,b),this.Init()}var c=a("base"),d=function(a,c){new b(a,c)};return b.prototype={Init:function(){this.curHover=null,this.Print(),this.Bind()},Print:function(){if(!$("#s-moreview").length){var a="					<div id='s-moreview' style='position:absolute;display:none;'>						<img id='s-moreview_aimg' style='position: absolute;display:none;' src='' />						<a id='s-moreview_prev' class='s-moreview_btns' href='javascript:void(0);'></a>						<a id='s-moreview_next' class='s-moreview_btns' href='javascript:void(0);'></a>						<span id='s-moreview_page' style='position:absolute;'>0 / 0</span>					</div>				";$("body").append(a),this.animate_img=$("#s-moreview_aimg"),this.bar=$("#s-moreview"),this.prev=$("#s-moreview_prev"),this.next=$("#s-moreview_next"),this.page=$("#s-moreview_page")}},Bind:function(){var a=this,b=$(this.target);this._stimer=null,this._htimer=null,b.find(this.opt.onNode).hover(function(){a.ShowBar(this)},function(){a.HideBar(this)}),$.each([this.prev,this.next,this.page,this.animate_img],function(){$(this).hover(function(){clearTimeout(a._htimer)},function(){a.HideBar()})}),this.prev.click(function(){a.loading||a.GetIMG(-1)}),this.next.click(function(){a.loading||a.GetIMG(1)})},ShowBar:function(a){var b=this;clearTimeout(this._stimer),clearTimeout(this._htimer),this._stimer=setTimeout(function(){b.curHover=a,b.SetPosInfo()},200)},HideBar:function(){var a=this;clearTimeout(this._stimer),clearTimeout(this._htimer),this._htimer=setTimeout(function(){a.bar.fadeOut(200),a.curHover=null},200)},SetPosInfo:function(){var a=$(this.curHover),b=this.GetData(),c=this.MatchIndex(b.curImg,b.arr);return b.arr.length<2?(this.bar.hide(),!1):(0!==a.outerWidth()&&(this.bar.css({left:a.offset().left,top:a.offset().top+a.outerHeight(!0),width:a.outerWidth(),height:0}),this.prev.css({top:.5*(-1*a.outerHeight(!0)-this.prev.outerHeight(!0))}),this.next.css({top:.5*(-1*a.outerHeight(!0)-this.next.outerHeight(!0))})),this.bar.show(),this.page.text(c+1+" / "+b.arr.length),void 0)},GetIMG:function(a){if(null!=this.curHover){this.loading=!0;var b=this,d=this.GetData(),e=this.MatchIndex(d.curImg,d.arr),f=e+a;0>f&&(f=d.arr.length-1),f>d.arr.length-1&&(f=0);var g=d.arr[f];g&&(this.loaderAnimate(),this.Tips().loading(),c.imgLoader(g,function(){var a=$(this).attr("src");$(d.curImg).attr("src",a).hide(),$(d.curImg).fadeIn(200,function(){b.SetPosInfo(),b.animate_img.attr("src",g),b.bar.fadeIn(200)}),b.Tips().success(),b.loading=!1,b.opt.onFinish(d.curImg,f)})),this.opt.updateHref&&this.UpdateHref(d.curImg,f)}},GetData:function(){var a=null,b=[],c=$(this.curHover).attr("list");return c?a=this.curHover:$(this.curHover).find("img").each(function(){c=$(this).attr("list"),a=this}),b=void 0===c?[]:c.split(","),{arr:this.Unique(b),curImg:a}},MatchIndex:function(a,b){for(var c=$(a).attr("src"),d=0;d<b.length;d++){var e=new RegExp(b[d]);if(e.test(c))return d}return-1},Unique:function(a){for(var b=[],c=0;c<a.length;c++){for(var d=!1,e=a[c],f=0;f<b.length;f++){var g=b[f];g===e&&(d=!0)}d||b.push(e)}return b},UpdateHref:function(a,b){var c="",d=$(a).closest("a"),e=d.attr("href").split("?");if(e[1]){if(/mv-index/.test(e[1]))e[1]=e[1].replace(/mv-index=(\d+)/,function(){return"mv-index="+b});else{var f=[];params=e[1].split("&");for(var g=0;g<params.length;g++)""!==params[g]&&f.push(params[g]);e[1]=f.join("&")+"&mv-index="+b}c=e[0]+"?"+e[1]}else c=e[0]+"?mv-index="+b;d.attr("href",c)},loaderAnimate:function(){},Tips:function(){var a=this;return{setPos:function(){var b=$(a.curHover);a.loader.css({left:.5*b.innerWidth()-.5*a.loader.innerWidth(),top:-1*.2*b.innerHeight()-.5*a.loader.innerHeight()+a.opt.yOffset})},loading:function(){a.opt.tipsLocked||(this.setPos(),a.loader.html(a.opt.loading).fadeIn(60))},success:function(){a.opt.tipsLocked||(this.setPos(),a.loader.fadeOut(60))},error:function(){a.opt.tipsLocked||(this.setPos(),a.loader.html(a.opt.error).fadeIn(60))}}}},d}),define("simpleTree",function(){var a=function(a,b){this.elem=a,this.opt={handler:".title",toggleClass:"title_selected",showtarget:"ul",currentClass:".menu-list-current"},$.extend(this.opt,b),this.init()};return a.prototype={init:function(){var a=$(this.elem),b=this;a.find(b.opt.currentClass).parents(b.opt.showtarget).show(),a.find(b.opt.currentClass).parents(b.opt.showtarget).prev().find(b.opt.handler).addClass(b.opt.toggleClass),this.bind()},bind:function(){var a=$(this.elem),b=this;a.find(b.opt.handler).bind("click",function(){b.animate()})},animate:function(){var a=$(this.elem),b=this,c=a.find(b.opt.handler);c.hasClass(b.opt.toggleClass)?c.removeClass(b.opt.toggleClass):c.addClass(b.opt.toggleClass),c.parents().find(a.find(b.opt.showtarget)).animate({height:"toggle"},100)}},a}),define(function(a){var b=a("moreview"),c=a("simpleTree");$(function(){new b($(".goods_item"),{onNode:"dt > a"}),$(".list_left > dl").each(function(){new c(this,{handler:">dt",toggleClass:"plus",showtarget:"dd"})})})});